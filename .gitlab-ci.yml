.docker_boostrap: &docker_boostrap |
  [[ ! -e /.dockerenv ]] && exit 0
  set -xe
    
  # Install git (the php image doesn't have it) which is required by composer
  apt-get update -yq
  apt-get install git redis-server phpredis -y

  # Install phpunit, the tool that we will use for testing
  curl --location --output /usr/local/bin/phpunit https://phar.phpunit.de/phpunit.phar
  chmod +x /usr/local/bin/phpunit

  # Install mysql driver
  # Here you can install any other extension that you need
  docker-php-ext-install redis


# Test PHP 7.0
test:7.0:
  image: php:7.0
  before_script:
    - *docker_boostrap
  script:
    - phpunit --configuration phpunit.xml.dist
  tags:
    - docker

# Test PHP 7.2
test:7.1:
  image: php:7.1
  before_script:
    - *docker_boostrap
  script:
    - phpunit --configuration phpunit.xml.dist
  tags:
    - docker

# Test PHP 7.2
test:7.2:
  image: php:7.2
  before_script:
    - *docker_boostrap
  script:
    - phpunit --configuration phpunit.xml.dist
  tags:
    - docker